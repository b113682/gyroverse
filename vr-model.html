<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>3Dãƒ¢ãƒ‡ãƒ« VRä½“é¨“ - ãƒ‡ãƒãƒƒã‚°ç‰ˆ</title>
    <meta name="description" content="ã‚¹ãƒ†ãƒ¬ã‚ªã‚¹ã‚³ãƒ”ãƒƒã‚¯VRä½“é¨“">
    <!-- A-Frameãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script>
        // ãƒ‡ãƒãƒƒã‚°æƒ…å ±è¡¨ç¤ºç”¨
        var debugInfo = {
            position: '',
            direction: '',
            moving: false,
            vrMode: false
        };

        function updateDebugDisplay() {
            var debugEl = document.getElementById('debug');
            if (debugEl) {
                debugEl.innerHTML = 
                    'ä½ç½®: ' + debugInfo.position + '<br>' +
                    'æ–¹å‘: ' + debugInfo.direction + '<br>' +
                    'ç§»å‹•ä¸­: ' + debugInfo.moving + '<br>' +
                    'VRãƒ¢ãƒ¼ãƒ‰: ' + debugInfo.vrMode;
            }
        }

        // ã‚¿ãƒƒãƒã§å‰é€²ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆä¿®æ­£ç‰ˆï¼‰
        AFRAME.registerComponent('touch-to-move', {
            schema: {
                speed: {default: 0.1}
            },
            init: function() {
                this.moving = false;
                this.touchCount = 0;
                
                this.touchStartHandler = this.onTouchStart.bind(this);
                this.touchEndHandler = this.onTouchEnd.bind(this);
                
                window.addEventListener('touchstart', this.touchStartHandler);
                window.addEventListener('touchend', this.touchEndHandler);
            },
            onTouchStart: function(evt) {
                this.touchCount = evt.touches.length;
                if (evt.touches.length === 1) {
                    this.moving = true;
                    debugInfo.moving = true;
                }
            },
            onTouchEnd: function(evt) {
                this.touchCount = evt.touches.length;
                if (evt.touches.length === 0) {
                    this.moving = false;
                    debugInfo.moving = false;
                }
            },
            tick: function() {
                if (this.moving && this.touchCount === 1) {
                    var rig = this.el;
                    var camera = rig.querySelector('a-camera');
                    if (!camera) return;
                    
                    // ã‚«ãƒ¡ãƒ©ã®å›è»¢ã‹ã‚‰æ–¹å‘ã‚’å–å¾—
                    var rotation = camera.getAttribute('rotation');
                    var yaw = THREE.MathUtils.degToRad(rotation.y);
                    
                    // Yè»¸å›è»¢ã®ã¿ã‚’ä½¿ç”¨ã—ã¦æ°´å¹³æ–¹å‘ã‚’è¨ˆç®—
                    var direction = new THREE.Vector3(
                        -Math.sin(yaw),
                        0,
                        -Math.cos(yaw)
                    );
                    
                    debugInfo.direction = 'x:' + direction.x.toFixed(2) + ' z:' + direction.z.toFixed(2);
                    
                    var position = rig.getAttribute('position');
                    position.x += direction.x * this.data.speed;
                    position.z += direction.z * this.data.speed;
                    rig.setAttribute('position', position);
                    
                    debugInfo.position = 'x:' + position.x.toFixed(2) + ' y:' + position.y.toFixed(2) + ' z:' + position.z.toFixed(2);
                    updateDebugDisplay();
                }
            },
            remove: function() {
                window.removeEventListener('touchstart', this.touchStartHandler);
                window.removeEventListener('touchend', this.touchEndHandler);
            }
        });

        // ãƒ”ãƒ³ãƒã§ã‚ºãƒ¼ãƒ ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
        AFRAME.registerComponent('pinch-zoom', {
            init: function() {
                this.initialDistance = 0;
                this.currentFov = 80;
                
                this.touchStartHandler = this.onTouchStart.bind(this);
                this.touchMoveHandler = this.onTouchMove.bind(this);
                
                window.addEventListener('touchstart', this.touchStartHandler);
                window.addEventListener('touchmove', this.touchMoveHandler);
            },
            onTouchStart: function(evt) {
                if (evt.touches.length === 2) {
                    evt.preventDefault();
                    var dx = evt.touches[0].pageX - evt.touches[1].pageX;
                    var dy = evt.touches[0].pageY - evt.touches[1].pageY;
                    this.initialDistance = Math.sqrt(dx * dx + dy * dy);
                }
            },
            onTouchMove: function(evt) {
                if (evt.touches.length === 2) {
                    evt.preventDefault();
                    
                    var dx = evt.touches[0].pageX - evt.touches[1].pageX;
                    var dy = evt.touches[0].pageY - evt.touches[1].pageY;
                    var distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (this.initialDistance > 0) {
                        var ratio = distance / this.initialDistance;
                        var newFov = this.currentFov / ratio;
                        newFov = Math.max(30, Math.min(100, newFov));
                        
                        var camera = this.el.querySelector('a-camera');
                        if (camera) {
                            camera.setAttribute('camera', 'fov', newFov);
                        }
                    }
                    
                    this.initialDistance = distance;
                    var camera = this.el.querySelector('a-camera');
                    if (camera) {
                        this.currentFov = camera.getAttribute('camera').fov;
                    }
                }
            },
            remove: function() {
                window.removeEventListener('touchstart', this.touchStartHandler);
                window.removeEventListener('touchmove', this.touchMoveHandler);
            }
        });

        // VRãƒ¢ãƒ¼ãƒ‰ã§è¦–ç·šæ–¹å‘ã«è‡ªå‹•ç§»å‹•ï¼ˆä¿®æ­£ç‰ˆï¼‰
        AFRAME.registerComponent('gaze-move-vr', {
            schema: {
                speed: {default: 0.05}
            },
            init: function() {
                var self = this;
                this.vrEnabled = false;
                
                this.el.sceneEl.addEventListener('enter-vr', function() {
                    self.vrEnabled = true;
                    debugInfo.vrMode = true;
                    console.log('VRãƒ¢ãƒ¼ãƒ‰é–‹å§‹');
                });
                
                this.el.sceneEl.addEventListener('exit-vr', function() {
                    self.vrEnabled = false;
                    debugInfo.vrMode = false;
                    console.log('VRãƒ¢ãƒ¼ãƒ‰çµ‚äº†');
                });
            },
            tick: function() {
                if (!this.vrEnabled) return;
                
                var rig = this.el;
                var camera = rig.querySelector('a-camera');
                if (!camera) return;
                
                // ã‚«ãƒ¡ãƒ©ã®å›è»¢ã‹ã‚‰æ–¹å‘ã‚’å–å¾—
                var rotation = camera.getAttribute('rotation');
                var yaw = THREE.MathUtils.degToRad(rotation.y);
                
                // Yè»¸å›è»¢ã®ã¿ã‚’ä½¿ç”¨ã—ã¦æ°´å¹³æ–¹å‘ã‚’è¨ˆç®—
                var direction = new THREE.Vector3(
                    -Math.sin(yaw),
                    0,
                    -Math.cos(yaw)
                );
                
                var position = rig.getAttribute('position');
                position.x += direction.x * this.data.speed;
                position.z += direction.z * this.data.speed;
                rig.setAttribute('position', position);
                
                debugInfo.position = 'x:' + position.x.toFixed(2) + ' y:' + position.y.toFixed(2) + ' z:' + position.z.toFixed(2);
                debugInfo.direction = 'x:' + direction.x.toFixed(2) + ' z:' + direction.z.toFixed(2);
                updateDebugDisplay();
            }
        });
    </script>
    <style>
        body { margin: 0; overflow: hidden; }
        #instructions {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 15px;
            border-radius: 5px;
            font-family: Arial, sans-serif;
            font-size: 14px;
            z-index: 1000;
        }
        #debug {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(255,0,0,0.7);
            color: white;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <!-- æ“ä½œèª¬æ˜ -->
    <div id="instructions">
        ğŸ“± æ“ä½œæ–¹æ³•:<br>
        â€¢ 1æœ¬æŒ‡ã‚¿ãƒƒãƒ(é•·æŠ¼ã—): å‰é€²<br>
        â€¢ ã‚¹ãƒ¯ã‚¤ãƒ—: è¦–ç‚¹ç§»å‹•<br>
        â€¢ 2æœ¬æŒ‡ãƒ”ãƒ³ãƒ: ã‚ºãƒ¼ãƒ <br>
        â€¢ VRãƒ¢ãƒ¼ãƒ‰: è¦‹ãŸæ–¹å‘ã«è‡ªå‹•ç§»å‹•
    </div>

    <!-- ãƒ‡ãƒãƒƒã‚°æƒ…å ± -->
    <div id="debug">
        ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...
    </div>

    <!-- VRã‚·ãƒ¼ãƒ³ã®å®šç¾© -->
    <a-scene vr-mode-ui="enabled: true">
        <!-- ã‚«ãƒ¡ãƒ©ãƒªã‚°ï¼ˆç§»å‹•å¯èƒ½ãªã‚«ãƒ¡ãƒ©ã‚³ãƒ³ãƒ†ãƒŠï¼‰ -->
        <a-entity id="rig" 
                  touch-to-move="speed: 0.1"
                  pinch-zoom
                  gaze-move-vr="speed: 0.05"
                  position="0 1.6 3">
            <!-- ã‚«ãƒ¡ãƒ©ï¼ˆè¦–ç‚¹ï¼‰ -->
            <a-camera look-controls="pointerLockEnabled: false"
                      fov="80">
                <!-- ã‚«ãƒ¼ã‚½ãƒ«ï¼ˆè¦–ç·šæ“ä½œç”¨ï¼‰ -->
                <a-cursor></a-cursor>
            </a-camera>
        </a-entity>

        <!-- 3Dãƒ¢ãƒ‡ãƒ«ã®é…ç½® -->
        <a-entity 
            id="row2"
            gltf-model="url(LS-t_hy.glb)" 
            position="1 1.6 -2"
            scale="2 2 2"
            rotation="0 0 0">
        </a-entity>
        <a-entity 
            id="ro3"
            gltf-model="url(LS-t_MAI.glb)" 
            position="0 0.8 -2"
            scale="2 2 2"
            rotation="0 0 0">
        </a-entity>

        
        <!-- ç’°å¢ƒå…‰ï¼ˆå…¨ä½“ã‚’ç…§ã‚‰ã™å…‰ï¼‰ -->
        <a-light type="ambient" color="#BBB"></a-light>
        
        <!-- æŒ‡å‘æ€§ãƒ©ã‚¤ãƒˆï¼ˆç‰¹å®šæ–¹å‘ã‹ã‚‰ã®å…‰ï¼‰ -->
        <a-light type="directional" color="#FFF" intensity="0.6" position="-0.5 1 1"></a-light>
        
        <!-- ç©ºï¼ˆèƒŒæ™¯ï¼‰ -->
        <a-sky color="#ECECEC"></a-sky>

        <!-- åœ°é¢ï¼ˆå‚è€ƒç”¨ï¼‰ -->
        <a-plane position="0 0 0" 
                 rotation="-90 0 0" 
                 width="10" 
                 height="10" 
                 color="#7BC8A4">
        </a-plane>
        
    </a-scene>
</body>
</html>